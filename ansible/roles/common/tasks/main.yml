- name: Set timezone
  ansible.builtin.timezone:
    name: "{{ timezone }}"

- name: Install base packages
  ansible.builtin.apt:
    name:
      - ca-certificates
      - curl
      - gnupg
      - ufw
    state: present
    update_cache: true

- name: Enable UFW (default deny incoming)
  ansible.builtin.ufw:
    state: enabled
    policy: deny
  when: firewall_enabled

- name: Allow SSH
  ansible.builtin.ufw:
    rule: allow
    port: "{{ ssh_port }}"
    proto: tcp
  when: firewall_enabled

- name: Allow HTTP
  ansible.builtin.ufw:
    rule: allow
    port: "80"
    proto: tcp
  when: firewall_enabled

- name: Allow HTTPS
  ansible.builtin.ufw:
    rule: allow
    port: "443"
    proto: tcp
  when: firewall_enabled
