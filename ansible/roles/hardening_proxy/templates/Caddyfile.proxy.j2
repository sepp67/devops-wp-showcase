{
    log {
        output file {{ caddy_access_log }}
        format json
    }
}

(security_headers) {
    header {
        Strict-Transport-Security "max-age=31536000; includeSubDomains; preload"
        X-Content-Type-Options "nosniff"
        X-Frame-Options "DENY"
        Referrer-Policy "strict-origin-when-cross-origin"
    }

    {% if hardening_enable_csp %}
    header Content-Security-Policy "{{ hardening_csp_value }}"
    {% endif %}
}

(block_sensitive) {
    {% if hardening_block_sensitive_files %}
    @forbidden path *.env *.git* *.bak *.old
    respond @forbidden 403
    {% endif %}
}

(block_xmlrpc) {
    {% if hardening_block_xmlrpc %}
    @xmlrpc path /xmlrpc.php
    respond @xmlrpc 403
    {% endif %}
}

# ---- Sites ----
lavallee.tech {
    import security_headers
    import block_sensitive
    import block_xmlrpc

    reverse_proxy 10.0.0.11:8080
}

news.lavallee.tech {
    import security_headers
    import block_sensitive
    import block_xmlrpc

    reverse_proxy 10.0.0.12:8080
}
