- name: Ensure openssh-server present
  ansible.builtin.apt:
    name: openssh-server
    state: present
    update_cache: true

- name: Enforce key-only SSH auth (disable password auth)
  ansible.builtin.lineinfile:
    path: /etc/ssh/sshd_config
    regexp: '^PasswordAuthentication\s+'
    line: 'PasswordAuthentication no'
  notify: restart ssh
  when: hardening_os_ssh_keys_only

- name: Disable root login via SSH
  ansible.builtin.lineinfile:
    path: /etc/ssh/sshd_config
    regexp: '^PermitRootLogin\s+'
    line: 'PermitRootLogin no'
  notify: restart ssh
