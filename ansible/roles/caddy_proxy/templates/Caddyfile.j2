{
  email {{ caddy_email }}
}

{% for s in sites %}
{{ s.domain }}, www.{{ s.domain }} {
  encode gzip

  log {
    output file /var/log/caddy/{{ s.name }}.access.log {
      roll_size 10MiB
      roll_keep 10
      roll_keep_for 720h
    }
    format json
  }

  reverse_proxy {{ s.backend_host }}:{{ s.backend_port }} {
    header_up Host {host}
    header_up X-Real-IP {remote_host}
    header_up X-Forwarded-For {remote_host}
    header_up X-Forwarded-Proto {scheme}
  }
}
{% endfor %}
